<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">

<meta name="viewport" content="width=1024">

<title>milkcocoaのテストPC</title>
<meta name="description" content="milkcocoaのテストPC">
<meta name="keywords" content="test,">
<meta name="format-detection" content="telephone=no">
<link href="./css/style.css" rel="stylesheet" type="text/css">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="/apple-touch-icon.png" />
<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png" />
</head>

<body class="page-pc">
<div class="wrap">


<style>
#image{
  -webkit-transition: all .25s ease-out;
          transition: all .25s ease-out;
  -webkit-transform: rotate(0deg);
          transform: rotate(0deg);
}
#image.is-landscape{
  -webkit-transform: rotate(90deg);
          transform: rotate(90deg);
}
</style>
<section id="Body">
	<div id="output">
	</div>
</section><!-- /#Body -->



<footer>
	<p class="text-center">Copyright &copy; ONEMOREDOT. inc. All rights reserved.</p>
</footer>

</div><!-- /.wrap -->
<script src="./js/libs/jquery-1.11.3.min.js"></script>
<script src="https://cdn.mlkcca.com/v2.0.0/milkcocoa.js"></script>
<script src="./js/function.js"></script>

<script>
$(function(){

	// Ballクラス格納用array
	var ball_list = [];
	//  Shotクラス格納用array
	var shot_list = [];

	var image = document.getElementById('image');

	// app_idは自分のものに書き換えてください
	var milkcocoa = new MilkCocoa("maxigxffjt7.mlkcca.com");
	var ds = milkcocoa.dataStore('gravity');
	var shot_ds = milkcocoa.dataStore('shot');
	var shot_cli_ds = milkcocoa.dataStore('shot_cli');

	ds.on('send', recieveBall);
	shot_ds.on('send', recieveShot);


	// タマをclientに送る
	function sendShot(e){
		var shot = e.currentTarget;
		shot_cli_ds.send({
			x: shot.x,
			y: shot.y,
			spd: shot.spd
		});
		shot.removeEventListener("sended",sendShot);
		$(shot.dom).remove();
		shot = null;
	}

	function recieveBall(sent){
		$('#output').append('<div id="Ball'+ball_list.length+'" class="ball"></div>');
		var _ball_dom = $('#Ball'+ball_list.length).get(0);
		
		var _ball = new Ball(_ball_dom,
													sent.value.posX,
													sent.value.posY+$('#Body').outerHeight(),
													sent.value.spdX,
													sent.value.spdY,
													sent.value.size,
													sent.value.color);
		_ball.setRect($('#Body').outerWidth(),$('#Body').outerHeight());
		$('#Ball'+ball_list.length).css({
			'left':_ball.posX+'px',
			'top':_ball.posY+'px',
			'width':_ball.size+'px',
			'height':_ball.size+'px',
			'background-color': _ball.color
		});
		_ball.start();
		ball_list.push(_ball);
	}

	function recieveShot(sent){
		$('#output').append('<div id="Shot'+shot_list.length+'" class="shot"></div>');
		var _shot_dom = $('#Shot'+shot_list.length).get(0);
		
		var _shot = new Shot(_shot_dom,
													sent.value.x,
													sent.value.y+$('#Body').outerHeight(),
													sent.value.spd);
		
		shot_list.push(_shot);
		_shot.addEventListener("sended", sendShot );
	}

});
</script>


</body>
</html>